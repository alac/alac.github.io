<html>
	<head>
		<meta http-equiv='Content-Type' content='text/html; charset=UTF-8'>
 	<title>  git / source control |  aimless bitshift</title>
 		<link rel='stylesheet' type='text/css' href='/assets/wvs.css'>
 		<link rel='stylesheet' type='text/css' href='/assets/normalize.css' />
	</head>
	<body>
		<div class='container'>
			<div class='headerbar'>
				<a href="/" style="text-decoration:none">
					<span style="color:#366B8F">
						aimless 
						<span style="color:white">bit</span>shift 
					</span>
				</a>
				<span class='headerbarMenu'>
					notes/realizations re:code
				</span>
			</div>
			<div class='subcontainer'>
				<div class='headerbarSpacer'></div>
				<div class='header depthOneContent'>
					<div class="menuCategory">
						<div class="menuCategoryTitle">
							<a>Recent:</a>
						</div>
					
			  			<div class="menuCategoryPost">
					    	<a href="/statistics/2016/10/02/statistical_significance.html">* testing for statistical significance</a>
						</div>
					
			  			<div class="menuCategoryPost">
					    	<a href="/tools/2016/08/24/xcode.html">* tools: xcode</a>
						</div>
					
			  			<div class="menuCategoryPost">
					    	<a href="/objective-c/2016/06/28/simple_arc.html">* metaphor #2 simple automatic reference counting</a>
						</div>
					
			  			<div class="menuCategoryPost">
					    	<a href="/metaphors/2016/06/14/simple_computers.html">* metaphor #1 simple computers</a>
						</div>
					
			  			<div class="menuCategoryPost">
					    	<a href="/tools/2016/04/25/regular_expressions.html">* tools: regexes</a>
						</div>
					
					</div>
				</div>
				<div class='sidebar depthOneContent'>
<!-- 					display recent posts by categories                           -->
					<div class="menuCategory">
						<div class="menuCategoryTitle">
							<a>Recent:</a>
						</div>
					
			  			<div class="menuCategoryPost">
					    	<a href="/statistics/2016/10/02/statistical_significance.html">* testing for statistical significance</a>
						</div>
					
			  			<div class="menuCategoryPost">
					    	<a href="/tools/2016/08/24/xcode.html">* tools: xcode</a>
						</div>
					
			  			<div class="menuCategoryPost">
					    	<a href="/objective-c/2016/06/28/simple_arc.html">* metaphor #2 simple automatic reference counting</a>
						</div>
					
			  			<div class="menuCategoryPost">
					    	<a href="/metaphors/2016/06/14/simple_computers.html">* metaphor #1 simple computers</a>
						</div>
					
			  			<div class="menuCategoryPost">
					    	<a href="/tools/2016/04/25/regular_expressions.html">* tools: regexes</a>
						</div>
					
					</div>
					<br>
<!-- 					display all posts by categories                           -->
	
					<div class="menuCategory">
						<div class="menuCategoryTitle">
							<a name="Tools">Tools</a>
						</div>

						
						  	
						  								  		
						  	
						
						  	
						  		
						  			<div class="menuCategoryPost">
							    	<a href="/tools/2016/08/24/xcode.html">* xcode</a>
									</div>
						  								  		
						  	
						  		
						  			<div class="menuCategoryPost">
							    	<a href="/tools/2016/04/25/regular_expressions.html">* regexes</a>
									</div>
						  								  		
						  	
						  		
						  			<div class="menuCategoryPost">
							    	<a href="/tools/2015/05/23/source-control-gitting-started.html">* git / source control</a>
									</div>
						  								  		
						  	
						
    				</div>
	
					<div class="menuCategory">
						<div class="menuCategoryTitle">
							<a name="Objective-C">Objective-C</a>
						</div>

						
						  	
						  								  		
						  	
						
						  	
						  		
						  			<div class="menuCategoryPost">
							    	<a href="/objective-c/2016/06/28/simple_arc.html">* simple automatic reference counting</a>
									</div>
						  								  		
						  	
						  		
						  			<div class="menuCategoryPost">
							    	<a href="/objective-c/2016/04/04/objective_c_patterns.html">* interaction patterns</a>
									</div>
						  								  		
						  	
						
    				</div>
	
					<div class="menuCategory">
						<div class="menuCategoryTitle">
							<a name="Unix">Unix</a>
						</div>

						
						  	
						  								  		
						  	
						
						  	
						  		
						  			<div class="menuCategoryPost">
							    	<a href="/unix/2016/04/12/p1_unix_in_short.html">* part 1: getting around</a>
									</div>
						  								  		
						  	
						
    				</div>
	
					<div class="menuCategory">
						<div class="menuCategoryTitle">
							<a name="Metaphors">Metaphors</a>
						</div>

						
						  	
						  								  		
						  	
						
						  	
						  		
						  			<div class="menuCategoryPost">
							    	<a href="/metaphors/2016/06/14/simple_computers.html">* simple computers</a>
									</div>
						  								  		
						  	
						
    				</div>
	
					<div class="menuCategory">
						<div class="menuCategoryTitle">
							<a name="Statistics">Statistics</a>
						</div>

						
						  	
						  								  		
						  	
						
						  	
						  		
						  			<div class="menuCategoryPost">
							    	<a href="/statistics/2016/10/02/statistical_significance.html">* significance and the t-test</a>
									</div>
						  								  		
						  	
						
    				</div>
	
				</div>
				<div class='content'>
				  <div class='post depthOneContent'>
	<div class='postHeader'>
	<h1>
		tools: git / source control
	</h1>
	</div>
	<div class='postBody'>
	23 May 2015 | Tools
	<p><img src="/assets/posts/git/git-meme.jpg" alt="Git Meme" title="Force pushing is for jedi" class="center-image" /></p>

<p>In this post:</p>

<ul>
  <li>Source Control/Git Intro</li>
  <li>Tools for Git</li>
  <li>Super Useful Command-Line Commands!</li>
</ul>

<!--more-->

<h2 id="what-is-source-control">What is source control?</h2>
<p>Think back to high school. Your essay is 10.5 pages instead of 11, so you thesaurous <em>real hard</em>. In the sobering morning light, you realize it was a mistake and hold down CTRL-Z.</p>

<p>Now, suppose you wanted CTRL-Z for code. It would need to occur for each ‘logical change’ otherwise it wouldn’t compile. It would need to handle multiple people working on the same code at the same time. And so on. That’s basically source control.</p>

<p>For more see:</p>

<ul>
  <li><a href="http://discuss.joelonsoftware.com/default.asp?W190">Joel on Software wiki</a></li>
  <li><a href="http://en.wikipedia.org/wiki/Revision_control">Wikipedia - Revision Control</a></li>
</ul>

<h2 id="git">Git?</h2>
<p>There’s infinity solutions to this problem, but right now the clear winner for source control software is <a href="http://en.wikipedia.org/wiki/Git_(software)">Git</a>.</p>

<p>The most common place to host a Git project is <a href="http://www.github.com">GitHub</a>. Almost all hosting providers have a ‘free’ tier of service with the caveat that your repository will be public. Private github accounts start at 5 repositories @ $7/month. If you’re too cool for that, you can use a <a href="http://treeleafmedia.be/blog/2011/03/creating-a-new-git-repository-on-a-local-file-system/">local remote repository</a> or set up your own git server (supposing you have a <a href="http://wiki.dreamhost.com/Git">DreamHost account</a> or something)</p>

<p>There’s two ways to use git:</p>

<ul>
  <li>
    <p>Command Line (<a href="https://try.github.io/levels/1/challenges/1">tutorial</a>)</p>

    <p>It’ll often be faster to use a GUI for most operations, but debugging with a GUI is needlessly difficult.</p>

    <p>You’ll want an understanding of the command line for the sake of the spamming ‘uhh what if I do this’ commands at the prompt.</p>
  </li>
  <li>
    <p>GUI tools.</p>

    <p>Github has a free client for each major platform. Because it errs on the side of being user friendly, it isn’t quite as efficient to use other options.</p>

    <p>For OS X, I’ve personally used the free <a href="https://www.sourcetreeapp.com/">SourceTree</a> and <a href="http://rowanj.github.io/gitx/">GitX-dev</a>. Both offer more industrial layouts that make it faster to work with branches, tags and submodules. GitX-dev</p>

    <p>Be careful to download GitX-dev instead of GitX, only the former is still being maintained and the latter lacks many many great features.</p>
  </li>
</ul>

<h2 id="ignoring-files">Ignoring files</h2>
<p>You’re going to want to ignore certain files in your git repo.</p>

<p>Common files to ignore are:</p>

<ul>
  <li>per-user configurations (not to be shared with teams) and</li>
  <li>temporary files (from the editor of whatever you’re doing).</li>
</ul>

<p>Open the .gitigonore file in your repo to include the files you want to exclude.</p>

<p>You can also get .gitignore templates for tools (IDEs, environments, etc) <a href="https://www.gitignore.io/">here</a>.</p>

<h2 id="less-obvious-commands">Less Obvious Commands</h2>
<p>Many of these you may want to ALIAS into a macro in your bash_profile / zshrc. In order of most obvious to least:</p>

<ul>
  <li>
    <p><code class="highlighter-rouge">git checkout -- filename</code>.</p>

    <p>Undo changes for a particular file.</p>
  </li>
  <li>
    <p><code class="highlighter-rouge">git reset HEAD filename</code>.</p>

    <p>Unstage changes for a particular file.</p>
  </li>
  <li>
    <p><code class="highlighter-rouge">git add -A</code>.</p>

    <p>Stage all changes to the current repo. Suppose you ran a script that modified or deleted hundreds of files in the repo.</p>
  </li>
  <li>
    <p><code class="highlighter-rouge">git clean -fd</code>.</p>

    <p>Delete all files in your repo that are not already a part of your repo or staged.</p>
  </li>
  <li>
    <p><code class="highlighter-rouge">git reset --hard head</code>.</p>

    <p>Undo all unstaged changes to files that are a part of your repo.</p>
  </li>
  <li>
    <p><code class="highlighter-rouge">git submodule foreach --recursive git reset --hard</code>.</p>

    <p>The above, but recursive. useful for reverting overly agressive changes (e.g. find and replace).</p>
  </li>
  <li>
    <p><code class="highlighter-rouge">git rebase -i refA</code>. Rebase on top of a branch interactively. Use this to combine, throw out or rename commits. For each commit, your options are r (rename), e (edit; pause the rebase after applying that commit, so that you can edit it there), p (pick), and s (squash; combine with the previous commit). <a href="https://github.com/chadburrus/gitbook/blob/06ec1a6450ae86d5cb0d2392f43ed42a2d9914de/text/14_Interactive_Rebasing/0_%20Interactive_Rebasing.markdown">Better description</a>.</p>
  </li>
  <li>
    <p><code class="highlighter-rouge">git reflog</code>.</p>

    <p>Shows the history of changes. Useful when, say, you accidentally delete a branch.</p>
  </li>
  <li>
    <p><code class="highlighter-rouge">git log refA...refB</code>.</p>

    <p>Show the log of differences commits in refB but not refA.</p>
  </li>
  <li>
    <p><code class="highlighter-rouge">git log refA...refB</code>.</p>

    <p>Show the log of differences between two branches (symmetric distance).</p>
  </li>
  <li>
    <p><code class="highlighter-rouge">git rev-list refA..refB | xargs -n 1 git show --quiet --format=oneline -n 1 &gt; changes.txt </code></p>

    <p>Dump the commits and commit messages that are in refB but not refA.</p>
  </li>
  <li>
    <p><code class="highlighter-rouge">git log --pretty=format:"%h - %an : %s"</code>.</p>

    <p>Show an abbreviated log. More options <a href="http://git-scm.com/book/en/v2/Git-Basics-Viewing-the-Commit-History">here</a>.</p>
  </li>
  <li>
    <p><code class="highlighter-rouge">git grep STRING</code>.</p>

    <p>Search all indexed files for STRING. Lifesaver if regular <code class="highlighter-rouge">grep</code> gives you unwanted results from gitignored files.</p>
  </li>
  <li>
    <p><code class="highlighter-rouge">git mergebase A B</code>.</p>

    <p>Get the common ancestor of commits A and B.</p>
  </li>
  <li>
    <p><code class="highlighter-rouge">git --no-pager diff --name-only A $(git merge-base A B)</code>.</p>

    <p>Get the names of files that changed between commits A and B.</p>
  </li>
</ul>

<h2 id="configuration">Configuration</h2>
<p>Here’s some things you can change with your git configuration:</p>

<ul>
  <li>
    <p><a href="https://git-scm.com/blog/2010/03/08/rerere.html">Rerere: “reuse recorded resolution”</a>. That is, automatic handling of repeated conflicts.</p>

    <p>By turning rerere on with <code class="highlighter-rouge">git config --global rerere.enabled true</code>, git can remember every resolution to a merge conflict and recycle it. Useful for long rebases.</p>

    <p>If you end up screwing up a resolution, forget it with <code class="highlighter-rouge">git rerere forget FILE</code> and checkout the conflicted version again <code class="highlighter-rouge">git checkout -m FILE</code>.</p>

    <p>If you screw up <em>many</em> files, you can nuke all resolutions with <code class="highlighter-rouge">rm -rf .git/rr-cache</code>.</p>
  </li>
  <li>
    <p>Always rebase when pulling.</p>

    <p>Use <code class="highlighter-rouge">git config branch.autosetuprebase always</code> to rebase when pulling. Useful if you work… with others. Although, you may as well make a bash profile shortcut for pulling that includes the <code class="highlighter-rouge">--rebase</code> flag.</p>

    <p>You can add <code class="highlighter-rouge">--global</code> to apply to all repos.</p>
  </li>
</ul>

<p>More options <a href="https://git-scm.com/book/tr/v2/Customizing-Git-Git-Configuration">here</a>. Highlighting and a merging tool are both recommended.</p>

<h2 id="bisect-to-find-breaking-changes">Bisect To Find Breaking Changes</h2>
<p>Suppose you have a bug and can’t determine the cause by inspecting the current codebase. Use a bisect to bruteforce your way to the code change that caused it.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>git bisect start
git bisect bad KNOWN_BAD_COMMIT
git bisect good KNOWN_GOOD_COMMIT
</code></pre>
</div>

<p>Git check out commits for you. You’ll test each one, then tell git if the code was broken or not:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>git bisect good # that commit wasn't broken
git bisect bad # that commit was broken
</code></pre>
</div>

<p>Then at the end (or when you’ve decided to give up), run reset:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>git bisect reset
</code></pre>
</div>

<p>Examples of other options (and automated testing) <a href="https://git-scm.com/docs/git-bisect">here</a></p>

<h2 id="handling-multiple-github-accounts">Handling Multiple Github Accounts</h2>
<p>Having multiple githubs accounts is actually just something you shouldn’t do, but if you’re already there…</p>

<p>You can’t authenticate to multiple github accounts with the same ssh key. So, you’ll need to switch between ssh keys whenever you switch accounts. You’ll run three commands:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>ssh-agent # start the ssh agent
ssh-add -d # remove the current identity
ssh-add ~.ssh/id_rsa_XYZ # add the new identity
</code></pre>
</div>

<p>I recommend adding a macro for this. I use this</p>

<div class="highlighter-rouge"><pre class="highlight"><code>alias sshwork="ssh-agent; ssh-add -d; 
ssh-add ~.ssh/id_rsawork"
</code></pre>
</div>

<p>A gist on the topic <a href="https://gist.github.com/jexchan/2351996">here</a>.</p>

<h2 id="git-faster">Git Faster</h2>
<p>If you’re using git right, you’re necessarily using git <em>a lot</em>. It would be wise to add shortcuts to your bash profile. Examples:</p>

<ul>
  <li>
    <p>Jumping to the root directories of you repos / submodules.</p>

    <p>E.g. adding <code class="highlighter-rouge">alias blog="cd ~/repos/blog"</code></p>
  </li>
  <li>
    <p>Common general operations like pull, rebase, commit.</p>

    <p><code class="highlighter-rouge">alias gst="git status"</code>
 <code class="highlighter-rouge">alias gpr="git pull --rebase"</code>
 <code class="highlighter-rouge">alias gac="git add -A; git commit"</code></p>
  </li>
  <li>
    <p>Switching to popular branches, tags.</p>

    <p><code class="highlighter-rouge">alias glatest='git checkout master; git pull --rebase origin master; git submodule update --recursive --init'</code></p>
  </li>
  <li>
    <p>Nuking everything!</p>

    <p><code class="highlighter-rouge">alias nuke="git clean -fd; git reset --hard head; git submodule foreach --recursive git reset --hard"</code></p>
  </li>
  <li>
    <p>Get commits from all submodule</p>

    <p><code class="highlighter-rouge">alias commits="git rev-parse HEAD; git submodule foreach --recursive git rev-parse HEAD"</code></p>
  </li>
  <li>
    <p>Similarly, it’s not unreasonable to have <code class="highlighter-rouge">bulk commands</code> defined as functions: deepCommit, deepBranch,</p>
  </li>
</ul>

<h2 id="patches">Patches</h2>
<p>Suppose that you need to store off some commits outside of your repo. For example, debug changes.</p>

<p>You can do this by generating a <em>patch</em> file.</p>

<p>For a patch for each commit since a hash:<br />
<code class="highlighter-rouge">git format-patch HASH</code></p>

<p>You can specify a number of commits from that patch. E.g.<br />
<code class="highlighter-rouge">git format-patch -1 HASH</code>
Gives you patch for the exact hash.</p>

<p>For a patch that spans many commits…
<code class="highlighter-rouge">git format-patch -2 HASH --stdout &gt; hash_and_previous_commit.patch</code></p>

<p>To apply a patch<br />
<code class="highlighter-rouge">git apply PATCH_PATH</code></p>

<p>For merge conflict instead of straight rejection<br />
<code class="highlighter-rouge">git apply -3 PATCH_PATH</code></p>

<h2 id="appendix">Appendix</h2>
<p>Some other stuff that may be useful:</p>

<ul>
  <li><a href="https://training.github.com/kit/downloads/github-git-cheat-sheet.pdf">GitHub’s command cheat sheet</a></li>
  <li><a href="http://git-scm.com/docs/githooks">Git Hooks</a> can be used to enforce rules and behaviors within the repo (e.g. Minimum commit message length, automatically dumping saving the hash of a particular file, etc).</li>
  <li><a href="https://ariejan.net/2009/10/26/how-to-create-and-apply-a-patch-with-git/">Using Git Patches</a>.</li>
</ul>

	</div>
</div>
				</div>
			</div>
		</div>
	</body>
<html>