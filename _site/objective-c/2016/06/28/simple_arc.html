<html>
	<head>
		<meta http-equiv='Content-Type' content='text/html; charset=UTF-8'>
 	<title>  simple automatic reference counting |  aimless bitshift</title>
 		<link rel='stylesheet' type='text/css' href='/assets/wvs.css'>
 		<link rel='stylesheet' type='text/css' href='/assets/normalize.css' />
	</head>
	<body>
		<div class='container'>
			<div class='headerbar'>
				<a href="/" style="text-decoration:none">
					<span style="color:#366B8F">
						aimless 
						<span style="color:white">bit</span>shift 
					</span>
				</a>
				<span class='headerbarMenu'>
					notes/realizations re:code
				</span>
			</div>
			<div class='subcontainer'>
				<div class='headerbarSpacer'></div>
				<div class='header depthOneContent'>
					<div class="menuCategory">
						<div class="menuCategoryTitle">
							<a>Recent:</a>
						</div>
					
			  			<div class="menuCategoryPost">
					    	<a href="/tools/2016/08/24/xcode.html">* tools: xcode</a>
						</div>
					
			  			<div class="menuCategoryPost">
					    	<a href="/objective-c/2016/06/28/simple_arc.html">* metaphor #2 simple automatic reference counting</a>
						</div>
					
			  			<div class="menuCategoryPost">
					    	<a href="/metaphors/2016/06/14/simple_computers.html">* metaphor #1 simple computers</a>
						</div>
					
			  			<div class="menuCategoryPost">
					    	<a href="/tools/2016/04/25/regular_expressions.html">* tools: regexes</a>
						</div>
					
			  			<div class="menuCategoryPost">
					    	<a href="/unix/2016/04/12/p1_unix_in_short.html">* unix part 1: in short</a>
						</div>
					
					</div>
				</div>
				<div class='sidebar depthOneContent'>
<!-- 					display recent posts by categories                           -->
					<div class="menuCategory">
						<div class="menuCategoryTitle">
							<a>Recent:</a>
						</div>
					
			  			<div class="menuCategoryPost">
					    	<a href="/tools/2016/08/24/xcode.html">* tools: xcode</a>
						</div>
					
			  			<div class="menuCategoryPost">
					    	<a href="/objective-c/2016/06/28/simple_arc.html">* metaphor #2 simple automatic reference counting</a>
						</div>
					
			  			<div class="menuCategoryPost">
					    	<a href="/metaphors/2016/06/14/simple_computers.html">* metaphor #1 simple computers</a>
						</div>
					
			  			<div class="menuCategoryPost">
					    	<a href="/tools/2016/04/25/regular_expressions.html">* tools: regexes</a>
						</div>
					
			  			<div class="menuCategoryPost">
					    	<a href="/unix/2016/04/12/p1_unix_in_short.html">* unix part 1: in short</a>
						</div>
					
					</div>
					<br>
<!-- 					display all posts by categories                           -->
	
					<div class="menuCategory">
						<div class="menuCategoryTitle">
							<a name="Tools">Tools</a>
						</div>

						
						  	
						  								  		
						  	
						
						  	
						  		
						  			<div class="menuCategoryPost">
							    	<a href="/tools/2016/08/24/xcode.html">* xcoding</a>
									</div>
						  								  		
						  	
						  		
						  			<div class="menuCategoryPost">
							    	<a href="/tools/2016/04/25/regular_expressions.html">* regexes</a>
									</div>
						  								  		
						  	
						  		
						  			<div class="menuCategoryPost">
							    	<a href="/tools/2015/05/23/source-control-gitting-started.html">* git / source control</a>
									</div>
						  								  		
						  	
						
    				</div>
	
					<div class="menuCategory">
						<div class="menuCategoryTitle">
							<a name="Objective-C">Objective-C</a>
						</div>

						
						  	
						  								  		
						  	
						
						  	
						  		
						  			<div class="menuCategoryPost">
							    	<a href="/objective-c/2016/06/28/simple_arc.html">* simple automatic reference counting</a>
									</div>
						  								  		
						  	
						  		
						  			<div class="menuCategoryPost">
							    	<a href="/objective-c/2016/04/04/objective_c_patterns.html">* interaction patterns</a>
									</div>
						  								  		
						  	
						
    				</div>
	
					<div class="menuCategory">
						<div class="menuCategoryTitle">
							<a name="Unix">Unix</a>
						</div>

						
						  	
						  								  		
						  	
						
						  	
						  		
						  			<div class="menuCategoryPost">
							    	<a href="/unix/2016/04/12/p1_unix_in_short.html">* part 1: getting around</a>
									</div>
						  								  		
						  	
						
    				</div>
	
					<div class="menuCategory">
						<div class="menuCategoryTitle">
							<a name="Metaphors">Metaphors</a>
						</div>

						
						  	
						  								  		
						  	
						
						  	
						  		
						  			<div class="menuCategoryPost">
							    	<a href="/metaphors/2016/06/14/simple_computers.html">* simple computers</a>
									</div>
						  								  		
						  	
						
    				</div>
	
				</div>
				<div class='content'>
				  <div class='post depthOneContent'>
	<div class='postHeader'>
	<h1>
		metaphor #2 simple automatic reference counting
	</h1>
	</div>
	<div class='postBody'>
	28 Jun 2016 | Objective-C
	<p>Memory management is an interesting topic because there’s two major ways of thinking about it: garbage collection and malloc/free.</p>

<p>Garbage collection is a really intuitive concept, and yet malloc/free is what is “natural”. It’s what mirrors the literal behavior of the compiler closest.</p>

<p>Objective C’s ARC starts from a malloc/free type system (retain counts) and attempts to emulate garbage collection.</p>

<p>And it gets weird because it isn’t garbage collection.</p>

<p>Here’s what it is instead.</p>

<!--more-->

<p>The preferred way of thinking about it is the concept of ‘ownership’. An object is alive for as long as at least one other living object is ‘owning it’.</p>

<p>While it’s a useful pattern, ownership isn’t how things really work. Just a useful way of thinking of it.</p>

<p>Instead, let’s think about tickets. You are an object - in the programming sense - and you’re alive as long as you hold one or more tickets.</p>

<p>Whenever ‘retain’ is called, you get a ticket.</p>

<p>Whenever ‘release’ is called, you lose a ticket.</p>

<p>Whenever ‘autorelease’ is called, you get a <em>self-destructing</em> ticket that goes away when the current autorelease pool flushes. (Usually, the flush happens at the end of a run loop.)</p>

<p>You get an implicit ‘retain’ when you’re initialized; this is why <em>before arc</em> it was common to call autorelease on an object when it was initialized. That way, you don’t have to remember to release it when you’re actually done.</p>

<p>ARC does this <em>for you</em>, and - in release mode - cancels out the implicit retain and the autorelease, as a performance optimization in <code class="highlighter-rouge">[[OBJECT alloc] init]</code>.</p>

<p>This is why, in DEBUG mode, assigning a new object to a weak variable before assigning it to something else will work. But it doesn’t in RELEASE mode.</p>

<p>When else do retains and releases happen?</p>

<p>Assigning to a strong property or a non-__weak local variable triggers a retain.</p>

<p>Assigning something else to the property, or the object being deallocated triggers a release.</p>

<p>Assigning something else to the local variable triggers a release. But, the release also occurs when the variable stops being used. Like immediately. At least in RELEASE mode.</p>

<p>That’s actually about it.</p>

<p>The only thing beyond that worth saying is… calling method on an object <em>doesn’t</em> trigger a retain. This means that if an object calls code (say, a block) that triggers it’s own release… you can get a segmentation fault. GG.</p>

	</div>
</div>
				</div>
			</div>
		</div>
	</body>
<html>